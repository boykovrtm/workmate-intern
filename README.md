# Сервис выполнения асинхронных операций

## Запуск
Необходимо установить go версии 1.24.2

```bash
 go run cmd/app/main.go 
```

Приложение будет доступно в локальной сети [`localhost:8080`](http://localhost:8080)

## Добавление новых обработчиков

Добавить реализацию интерфейса `interfaces.Handler` 
в папке `internal/application/handlers` с уникальным именем в методе `.Name()`

Далее необходимо в `cmd/app/main.go` добавить регистрацию созданного хендлера `handlerCollection.Add(...)`

## Документация API управления задачами
**Базовый URL:** `http://localhost:8080/api/v1/tasks`

---

#### **1. Создать новую задачу**
**`POST /`**  
Создает задачу с указанным обработчиком и payload.

**Тело запроса (JSON):**
```json
{
  "name": "handler_name",
  "payload": "task_data"
}
```
- **`name`** (обязательно): Имя обработчика из `HandlerCollection` (регистрозависимо)
- **`payload`** (обязательно): Данные для обработки (строка)

**Успешный ответ (201 Created):**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "created": "2023-10-05T12:00:00Z",
  "taken_at": "2023-10-05T12:00:00Z",
  "completed_at": "2023-10-05T12:00:05Z",
  "processing-duration": "5s",
  "payload": "task_data",
  "status": 3,
  "result": "результат"
}
```
**Ошибки:**
- `400 Bad Request`: Некорректный JSON или отсутствуют поля
- `404 Not Found`: Обработчик `name` не найден
- `500 Internal Server Error`: Ошибка создания/сохранения задачи

**Пример:**
```bash
curl -X POST http://localhost:8080/api/v1/tasks/ \
  -H "Content-Type: application/json" \
  -d '{"name": "pdf_generator", "payload": "{\"title\":\"Report\"}"}'
```

---

#### **2. Получить задачу**
**`GET /:id`**  
Возвращает задачу по UUID.

**Параметры пути:**
- **`id`** (обязательно): UUID задачи (формат `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`)

**Успешный ответ (200 OK):**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "created": "2023-10-05T12:00:00Z",
  "taken_at": "2023-10-05T12:00:00Z",
  "completed_at": "2023-10-05T12:00:05Z",
  "processing-duration": "5s",
  "payload": "task_data",
  "status": 4,
  "result": "ошибка: timeout"
}
```
**Ошибки:**
- `400 Bad Request`: Невалидный UUID
- `404 Not Found`: Задача не найдена

**Пример:**
```bash
curl http://localhost:8080/api/v1/tasks/550e8400-e29b-41d4-a716-446655440000
```

---

#### **3. Повторить задачу**
**`PATCH /:id/retry`**  
Повторно запускает выполнение задачи (сбрасывает статус).

**Параметры пути:**
- **`id`** (обязательно): UUID задачи

**Успешный ответ (200 OK):**  
Возвращает обновлённую задачу (структура идентична `GET`)

**Ошибки:**
- `400 Bad Request`: Невалидный UUID
- `404 Not Found`: Задача не найдена

**Пример:**
```bash
curl -X PATCH http://localhost:8080/api/v1/tasks/550e8400-e29b-41d4-a716-446655440000/retry
```

---

#### **4. Удалить задачу**
**`DELETE /:id`**  
Удаляет задачу по UUID.

**Параметры пути:**
- **`id`** (обязательно): UUID задачи

**Успешный ответ (200 OK):**  
Пустое тело

**Ошибки:**
- `400 Bad Request`: Невалидный UUID
- `404 Not Found`: Задача не найдена

**Пример:**
```bash
curl -X DELETE http://localhost:8080/api/v1/tasks/550e8400-e29b-41d4-a716-446655440000
```

---

### Статусы задач (`status`)
| Значение | Имя         | Описание              |
|----------|-------------|-----------------------|
| 0        | `Unknown`   | Неизвестно            |
| 1        | `Created`   | Создана               |
| 2        | `InWork`    | В процессе выполнения |
| 3        | `Completed` | Успешно завершена     |
| 4        | `Failed`    | Завершена с ошибкой   |

